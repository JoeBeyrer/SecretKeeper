<div class="reset-container">
  <div class="reset-card">

    @if (pageState === 'request') {
      <h1>Forgot Password</h1>
      <form [formGroup]="requestForm" (ngSubmit)="onRequestSubmit()">
        <div class="form-group">
          <input
            type="email"
            formControlName="email"
            placeholder="Email address"
            class="form-control"
            autocomplete="email"
          />
        </div>
        @if (requestError) {
          <div class="error-message">{{ requestError }}</div>
        }
        @if (requestMessage) {
          <div class="success-message">{{ requestMessage }}</div>
        }
        <button type="submit" class="reset-button" [disabled]="isLoading">
          {{ isLoading ? 'Sending…' : 'Send Reset Link' }}
        </button>
        <div class="login-link">
          <p>Remembered it? <a (click)="goToLogin()">Back to login</a></p>
        </div>
      </form>
    }

    @if (pageState === 'validating') {
      <h1>Checking Link…</h1>
      <div class="spinner"></div>
    }

    @if (pageState === 'reset') {
      <h1>Set New Password</h1>
      <form [formGroup]="resetForm" (ngSubmit)="onResetSubmit()">
        <div class="form-group">
          <input
            type="password"
            formControlName="password"
            placeholder="New password"
            class="form-control"
            autocomplete="new-password"
          />
        </div>
        <div class="form-group">
          <input
            type="password"
            formControlName="confirmPassword"
            placeholder="Confirm new password"
            class="form-control"
            autocomplete="new-password"
          />
        </div>
        @if (resetError) {
          <div class="error-message">{{ resetError }}</div>
        }
        <button type="submit" class="reset-button" [disabled]="isLoading">
          {{ isLoading ? 'Saving…' : 'Update Password' }}
        </button>
      </form>
    }

    @if (pageState === 'expired') {
      <h1>Link Expired</h1>
      <p class="status-text">
        This reset link has expired or already been used. Links are only valid for 1 hour.
      </p>
      <button class="reset-button" (click)="requestNewLink()">Request New Link</button>
      <div class="login-link">
        <p>Remembered it? <a (click)="goToLogin()">Back to login</a></p>
      </div>
    }

    @if (pageState === 'success') {
      <h1>Password Updated!</h1>
      <p class="status-text">
        Your password has been changed. Log in with your new credentials.
      </p>
      <button class="reset-button" (click)="goToLogin()">Go to Login</button>
    }

  </div>
</div>
